<ContentPage
    x:Name="HomePageRoot"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:BingeBuddy.ViewModels"
    x:Class="BingeBuddy.Pages.HomePage"
    BackgroundColor="#2C3E50"
    NavigationPage.HasNavigationBar="False">

    <ContentPage.BindingContext>
        <viewmodels:MovieViewModel />
    </ContentPage.BindingContext>

    <AbsoluteLayout>

        <!-- Decorative Bubbles -->
        <Ellipse WidthRequest="200"
                 HeightRequest="180"
                 Fill="#34495E"
                 Opacity="0.50"
                 AbsoluteLayout.LayoutBounds="0.1, 0.1, 120, 200"
                 AbsoluteLayout.LayoutFlags="PositionProportional" />

        <Ellipse WidthRequest="150"
                 HeightRequest="150"
                 Fill="#1ABC9C"
                 Opacity="0.2"
                 AbsoluteLayout.LayoutBounds="1.1, 0.2, 100, 100"
                 AbsoluteLayout.LayoutFlags="PositionProportional" />

        <Ellipse WidthRequest="100"
                 HeightRequest="100"
                 Fill="DeepSkyBlue"
                 Opacity="0.2"
                 AbsoluteLayout.LayoutBounds="1.1, 0.1, 400, 0"
                 AbsoluteLayout.LayoutFlags="PositionProportional" />
        
        <Ellipse WidthRequest="160"
                 HeightRequest="160"
                 Fill="#3498DB"
                 Opacity="0.15"
                 AbsoluteLayout.LayoutBounds="0.9, 1.1, 160, 160"
                 AbsoluteLayout.LayoutFlags="PositionProportional" />

        <Ellipse WidthRequest="80"
                 HeightRequest="80"
                 Fill="#9B59B6"
                 Opacity="0.25"
                 AbsoluteLayout.LayoutBounds="0.2, 0.9, 200, 80"
                 AbsoluteLayout.LayoutFlags="PositionProportional" />

        <!-- Main Content Grid -->
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,*"
              Padding="15"
              RowSpacing="10"
              AbsoluteLayout.LayoutBounds="0,0,1,1"
              AbsoluteLayout.LayoutFlags="All">
        <!-- Top Bar -->
        <Grid Grid.Row="0"
              BackgroundColor="#2C3E50"
              Padding="5"
              HeightRequest="60"
              ColumnDefinitions="Auto,*"
              VerticalOptions="Center">
            <Image Source="logo.png"
                   HeightRequest="40"
                   VerticalOptions="Center"
                   HorizontalOptions="Start" />
            <SearchBar Grid.Column="1"
                       Placeholder="Search"
                       Text="{Binding SearchText}"
                       BackgroundColor="#22313A"
                       TextColor="White"
                       PlaceholderColor="#B0B0B0"
                       HeightRequest="40"
                       Margin="10,0,0,0"
                       HorizontalOptions="FillAndExpand" />
        </Grid>

        <!-- WATCHLIST Title -->
        <Label Grid.Row="1"
               Text="WATCHLIST"
               FontSize="26"
               FontAttributes="Bold"
               TextColor="White"
               HorizontalOptions="Center"
               Margin="0,10" />

        <!-- Filter Buttons -->
        <Grid Grid.Row="2"
              ColumnDefinitions="*,*"
              ColumnSpacing="10">
            <Button Grid.Column="0"
                    Text="In Progress"
                    Command="{Binding ShowInProgressCommand}"
                    BackgroundColor="{Binding InProgressButtonColor}"
                    TextColor="{Binding InProgressTextColor}"
                    Padding="12"
                    CornerRadius="20"
                    FontSize="16"
                    FontAttributes="Bold" />
            <Button Grid.Column="1"
                    Text="Completed"
                    Command="{Binding ShowCompletedCommand}"
                    BackgroundColor="{Binding CompletedButtonColor}"
                    TextColor="{Binding CompletedTextColor}"
                    Padding="12"
                    CornerRadius="20"
                    FontSize="16"
                    FontAttributes="Bold" />
        </Grid>

        <!-- Sort and Genre Filters -->
        <Grid Grid.Row="3" Padding="0,0,0,5">
            <HorizontalStackLayout HorizontalOptions="End" Spacing="20">
                <!-- Sort -->
                <StackLayout Orientation="Horizontal" Spacing="5" VerticalOptions="Center">
                    <Label Text="Sort by:" TextColor="White" VerticalOptions="Center" />
                    <Picker ItemsSource="{Binding SortOptions}"
                            SelectedItem="{Binding SelectedSortOption}"
                            WidthRequest="100"
                            TextColor="White"
                            BackgroundColor="#22313A"
                            FontSize="14"
                            Margin="0,0,0,5" />
                </StackLayout>

                <!-- Genre Filter -->
                <StackLayout Orientation="Horizontal" Spacing="5" VerticalOptions="Center">
                    <Label Text="Genre:" TextColor="White" VerticalOptions="Center" />
                    <Picker ItemsSource="{Binding Genres}"
                            SelectedItem="{Binding SelectedGenre}"
                            WidthRequest="100"
                            TextColor="White"
                            BackgroundColor="#22313A"
                            FontSize="14"
                            Margin="0,0,0,5" />
                </StackLayout>
            </HorizontalStackLayout>
        </Grid>

        <!-- Movie Cards -->
            <CollectionView Grid.Row="5" ItemsSource="{Binding MoviesInList}">
                <CollectionView.EmptyView>
                    <Label Text="No movies in your watchlist yet!"
                       TextColor="#CCCCCC"
                       FontSize="18"
                       HorizontalOptions="Center"
                       VerticalOptions="CenterAndExpand" />
                </CollectionView.EmptyView>

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="2" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="#1F2A38"
                           CornerRadius="20"
                           HasShadow="True"
                           Margin="6"
                           Padding="0">

                            <Grid RowDefinitions="Auto,Auto,Auto" Padding="10">
                                <Image Source="{Binding CoverPhoto}"
                                   HeightRequest="160"
                                   Aspect="AspectFill"
                                   HorizontalOptions="Fill"
                                   Grid.Row="0"
                                   Margin="0,0,0,8"
                                    />

                                <Label Text="{Binding Title}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   Grid.Row="1"
                                   Margin="0,0,0,6" />

                                <HorizontalStackLayout Grid.Row="2"
                                                   Spacing="8"
                                                   HorizontalOptions="Center">
                                    <Label Text="{Binding Year}" TextColor="#B0B0B0" FontSize="14" />
                                    <Label Text="·" TextColor="#B0B0B0" FontSize="14" />
                                    <Label Text="{Binding Genre}" TextColor="#B0B0B0" FontSize="14" />
                                    <Label Text="·" TextColor="#B0B0B0" FontSize="14" />
                                    <Label Text="Rating" TextColor="#B0B0B0" FontSize="14" />
                                    <Label Text="★" TextColor="#FFD700" FontSize="16" />
                                    <Label Text="{Binding Rating}" TextColor="#FFD700" FontSize="14" />
                                </HorizontalStackLayout>
                            </Grid>

                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer
                                Command="{Binding BindingContext.ShowMovieDetailsCommand, Source={x:Reference HomePageRoot}}"
                                CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </AbsoluteLayout>
</ContentPage>
